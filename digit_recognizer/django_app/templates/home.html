<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digit Recognizer</title>
<style>
    body {
        text-align: center;
        font-family: Arial;
        background-color: #f5f5f5;
    }
    canvas {
        border: 2px solid black;
        background-color: white;
        cursor: crosshair;
    }
    button {
        margin: 10px;
        padding: 10px 20px;
        font-size: 16px;
    }
</style>
</head>
<body>
<h1>ðŸ§  Handwritten Digit Recognizer</h1>

<canvas id="canvas" width="280" height="280"></canvas><br>
<button id="clear">Clear</button>
<button id="predict">Predict</button>

<h2 id="result"></h2>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// White background initially
ctx.fillStyle = "white";
ctx.fillRect(0, 0, canvas.width, canvas.height);

let drawing = false;

canvas.addEventListener("mousedown", () => drawing = true);
canvas.addEventListener("mouseup", () => {
    drawing = false;
    ctx.beginPath();
});
canvas.addEventListener("mousemove", draw);

function draw(e) {
    if (!drawing) return;
    ctx.lineWidth = 20;
    ctx.lineCap = "round";
    ctx.strokeStyle = "black";
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
}

document.getElementById("clear").onclick = () => {
    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    document.getElementById("result").innerText = "";
};

document.getElementById("predict").onclick = async () => {
    // Step 1: Convert the 280x280 image to 28x28 grayscale properly
    const smallCanvas = document.createElement("canvas");
    smallCanvas.width = 28;
    smallCanvas.height = 28;
    const smallCtx = smallCanvas.getContext("2d");
    smallCtx.drawImage(canvas, 0, 0, 28, 28);
    const imgData = smallCtx.getImageData(0, 0, 28, 28);

    let pixels = [];
    for (let i = 0; i < imgData.data.length; i += 4) {
        const gray = 255 - imgData.data[i]; // invert black/white
        pixels.push(gray / 255.0);
    }

    const response = await fetch("/predict/", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: "pixels=" + pixels.join(",")
    });

    const data = await response.json();
    document.getElementById("result").innerText =
        data.digit !== undefined ? "Predicted Digit: " + data.digit : "Error predicting";
};
</script>
</body>
</html>
